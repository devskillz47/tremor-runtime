
define flow main
flow
  use tremor::connectors;
  use integration;


  define connector in from file
  with
    codec = "json",
    preprocessors = ["separate"],
    initial_commands = [{"file_io": {"open": {"path": "in.json", "handle": "input", "mode": "read"}}}],
    config = {
    }
  end;

  define connector `udp-out` from udp_client
  with
    codec = "yaml",
    postprocessors = ["base64"],
    config = {
      "default_handle": "udp-out",
      "bind": "localhost:4244"
    },
    initial_commands = [
        {"socket_client": {"connect": {"address": "localhost:4243", "handle": "udp-out"}}}
    ]
  end;
  
  create pipeline main from integration::out_or_exit;
  create connector in;
  create connector `udp-out`;
  create connector exit from connectors::exit;

  connect /connector/in/out to /pipeline/main/in;
  connect /pipeline/main/out to /connector/`udp-out`/in;
  connect /pipeline/main/exit to /connector/exit/in;
end;

deploy flow main;
