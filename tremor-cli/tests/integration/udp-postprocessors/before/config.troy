
define flow main
flow
  use tremor::connectors;
  use integration;
  

  define connector `udp-in` from udp_server
  with
    codec = "string",
    config = { 
    },
    initial_commands = [
        {"socket_server": {"listen": {"address": "localhost:4243", "handle": "a"}}}
    ]
  end;

  define connector out from file
  with
    codec = "string",
    postprocessors = ["separate"],
    initial_commands = [{"file_io": {"open": {"mode": "write_truncate", "path": "../gen.log", "handle": "output"}}}],
    config = {
      "default_handle": "output"
    }
  end;


  create pipeline main from integration::out_or_exit;
  create connector `udp-in`;
  create connector debug from connectors::console;
  create connector exit from connectors::exit;
  create connector out;

  connect /connector/`udp-in` to /pipeline/main/in;
  connect /pipeline/main/out to /connector/out;
  connect /pipeline/main/out to /connector/debug;
  connect /pipeline/main/exit to /connector/exit/in;
end;

deploy flow main;